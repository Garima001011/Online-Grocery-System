<html>
<head>
<title>customer.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #6aab73;}
.s3 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
customer.js</font>
</center></td></tr></table>
<pre><span class="s0">let user = </span><span class="s1">null</span><span class="s0">;</span>
<span class="s0">let products = [];</span>
<span class="s0">let stores = [];</span>
<span class="s0">let categories = [];</span>
<span class="s0">let cart = JSON.parse(localStorage.getItem(</span><span class="s2">&quot;cart&quot;</span><span class="s0">)) || [];</span>
<span class="s0">let filters = {</span>
  <span class="s0">category: </span><span class="s1">null</span><span class="s0">,</span>
  <span class="s0">store: </span><span class="s1">null</span><span class="s0">,</span>
  <span class="s0">maxPrice: </span><span class="s3">5000</span><span class="s0">,</span>
  <span class="s0">inStockOnly: </span><span class="s1">true</span><span class="s0">,</span>
  <span class="s0">searchQuery: </span><span class="s2">&quot;&quot;</span>
<span class="s0">};</span>

<span class="s0">document.addEventListener(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="s0">, async () =&gt; {</span>
  <span class="s0">const userData = localStorage.getItem(</span><span class="s2">&quot;user&quot;</span><span class="s0">);</span>

  <span class="s1">if </span><span class="s0">(userData) {</span>
    <span class="s1">try </span><span class="s0">{</span>
      <span class="s0">user = JSON.parse(userData);</span>
      <span class="s0">const userGreetingEl = document.getElementById(</span><span class="s2">&quot;userGreeting&quot;</span><span class="s0">);</span>
      <span class="s1">if </span><span class="s0">(userGreetingEl) {</span>
        <span class="s0">const userName = user?.name || user?.email?.split(</span><span class="s2">&quot;@&quot;</span><span class="s0">)?.[</span><span class="s3">0</span><span class="s0">] || </span><span class="s2">&quot;User&quot;</span><span class="s0">;</span>
        <span class="s0">userGreetingEl.textContent = userName;</span>
        <span class="s0">userGreetingEl.onclick = (e) =&gt; {</span>
          <span class="s0">e.preventDefault();</span>
          <span class="s0">e.stopPropagation();</span>
          <span class="s0">toggleUserDropdown();</span>
        <span class="s0">};</span>
      <span class="s0">}</span>

      <span class="s0">const dropdownEmailEl = document.getElementById(</span><span class="s2">&quot;dropdownEmail&quot;</span><span class="s0">);</span>
      <span class="s1">if </span><span class="s0">(dropdownEmailEl &amp;&amp; user?.email) dropdownEmailEl.textContent = user.email;</span>

      <span class="s0">const dropdownRoleEl = document.getElementById(</span><span class="s2">&quot;dropdownRole&quot;</span><span class="s0">);</span>
      <span class="s1">if </span><span class="s0">(dropdownRoleEl &amp;&amp; user?.role) {</span>
        <span class="s0">dropdownRoleEl.textContent =</span>
          <span class="s0">user.role.charAt(</span><span class="s3">0</span><span class="s0">).toUpperCase() + user.role.slice(</span><span class="s3">1</span><span class="s0">).toLowerCase();</span>
      <span class="s0">}</span>

      <span class="s0">const logoutLink = document.getElementById(</span><span class="s2">&quot;logoutLink&quot;</span><span class="s0">);</span>
      <span class="s1">if </span><span class="s0">(logoutLink) logoutLink.style.display = </span><span class="s2">&quot;inline&quot;</span><span class="s0">;</span>
    <span class="s0">} </span><span class="s1">catch </span><span class="s0">(error) {</span>
      <span class="s0">redirectToLogin();</span>
      <span class="s1">return</span><span class="s0">;</span>
    <span class="s0">}</span>
  <span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
    <span class="s0">const userGreetingEl = document.getElementById(</span><span class="s2">&quot;userGreeting&quot;</span><span class="s0">);</span>
    <span class="s1">if </span><span class="s0">(userGreetingEl) {</span>
      <span class="s0">userGreetingEl.textContent = </span><span class="s2">&quot;Sign in&quot;</span><span class="s0">;</span>
      <span class="s0">userGreetingEl.onclick = </span><span class="s1">function </span><span class="s0">() {</span>
        <span class="s0">window.location.href = </span><span class="s2">&quot;/login-amazon.html&quot;</span><span class="s0">;</span>
      <span class="s0">};</span>
    <span class="s0">}</span>
    <span class="s0">const logoutLink = document.getElementById(</span><span class="s2">&quot;logoutLink&quot;</span><span class="s0">);</span>
    <span class="s1">if </span><span class="s0">(logoutLink) logoutLink.style.display = </span><span class="s2">&quot;none&quot;</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s0">updateCartCount();</span>

  <span class="s0">await Promise.all([loadStores(), loadCategories(), loadProducts()]);</span>
  <span class="s0">setupFilters();</span>

  <span class="s0">document.addEventListener(</span><span class="s2">&quot;keydown&quot;</span><span class="s0">, (e) =&gt; {</span>
    <span class="s1">if </span><span class="s0">(e.key === </span><span class="s2">&quot;Escape&quot;</span><span class="s0">) {</span>
      <span class="s0">const dropdown = document.getElementById(</span><span class="s2">&quot;userDropdown&quot;</span><span class="s0">);</span>
      <span class="s1">if </span><span class="s0">(dropdown) dropdown.style.display = </span><span class="s2">&quot;none&quot;</span><span class="s0">;</span>
    <span class="s0">}</span>
  <span class="s0">});</span>
<span class="s0">});</span>

<span class="s1">function </span><span class="s0">redirectToLogin() {</span>
  <span class="s0">localStorage.removeItem(</span><span class="s2">&quot;user&quot;</span><span class="s0">);</span>
  <span class="s0">window.location.href = </span><span class="s2">&quot;/login-amazon.html&quot;</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">toggleUserDropdown() {</span>
  <span class="s0">const dropdown = document.getElementById(</span><span class="s2">&quot;userDropdown&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(!dropdown) </span><span class="s1">return</span><span class="s0">;</span>

  <span class="s1">if </span><span class="s0">(!user) {</span>
    <span class="s0">window.location.href = </span><span class="s2">&quot;/login-amazon.html&quot;</span><span class="s0">;</span>
    <span class="s1">return</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s0">const isOpen = dropdown.style.display === </span><span class="s2">&quot;block&quot;</span><span class="s0">;</span>
  <span class="s0">dropdown.style.display = isOpen ? </span><span class="s2">&quot;none&quot; </span><span class="s0">: </span><span class="s2">&quot;block&quot;</span><span class="s0">;</span>

  <span class="s1">if </span><span class="s0">(!isOpen) {</span>
    <span class="s0">setTimeout(() =&gt; {</span>
      <span class="s0">document.addEventListener(</span><span class="s2">&quot;click&quot;</span><span class="s0">, closeDropdownOnClickOutside);</span>
    <span class="s0">}, </span><span class="s3">100</span><span class="s0">);</span>
  <span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
    <span class="s0">document.removeEventListener(</span><span class="s2">&quot;click&quot;</span><span class="s0">, closeDropdownOnClickOutside);</span>
  <span class="s0">}</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">closeDropdownOnClickOutside(event) {</span>
  <span class="s0">const dropdown = document.getElementById(</span><span class="s2">&quot;userDropdown&quot;</span><span class="s0">);</span>
  <span class="s0">const greeting = document.getElementById(</span><span class="s2">&quot;userGreeting&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(!dropdown || !greeting) </span><span class="s1">return</span><span class="s0">;</span>

  <span class="s1">if </span><span class="s0">(!dropdown.contains(event.target) &amp;&amp; !greeting.contains(event.target)) {</span>
    <span class="s0">dropdown.style.display = </span><span class="s2">&quot;none&quot;</span><span class="s0">;</span>
    <span class="s0">document.removeEventListener(</span><span class="s2">&quot;click&quot;</span><span class="s0">, closeDropdownOnClickOutside);</span>
  <span class="s0">}</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">logout() {</span>
  <span class="s0">const ok = confirm(</span><span class="s2">&quot;Are you sure you want to sign out?&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(!ok) </span><span class="s1">return false</span><span class="s0">;</span>

  <span class="s0">localStorage.removeItem(</span><span class="s2">&quot;user&quot;</span><span class="s0">);</span>
  <span class="s0">user = </span><span class="s1">null</span><span class="s0">;</span>

  <span class="s0">alert(</span><span class="s2">&quot;Successfully signed out!&quot;</span><span class="s0">);</span>
  <span class="s0">window.location.href = </span><span class="s2">&quot;/login-amazon.html&quot;</span><span class="s0">;</span>
  <span class="s1">return false</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">viewAccount() {</span>
  <span class="s0">showNotification(</span><span class="s2">&quot;Account page coming soon!&quot;</span><span class="s0">);</span>
  <span class="s0">const dropdown = document.getElementById(</span><span class="s2">&quot;userDropdown&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(dropdown) dropdown.style.display = </span><span class="s2">&quot;none&quot;</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">viewOrders() {</span>
  <span class="s0">window.location.href = </span><span class="s2">&quot;/orders.html&quot;</span><span class="s0">;</span>
  <span class="s0">const dropdown = document.getElementById(</span><span class="s2">&quot;userDropdown&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(dropdown) dropdown.style.display = </span><span class="s2">&quot;none&quot;</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s0">async </span><span class="s1">function </span><span class="s0">loadProducts() {</span>
  <span class="s1">try </span><span class="s0">{</span>
    <span class="s0">const response = await fetch(</span><span class="s2">&quot;/api/products&quot;</span><span class="s0">);</span>
    <span class="s0">products = await response.json();</span>
    <span class="s0">displayProducts(products);</span>
    <span class="s0">loadSuggestions();</span>
  <span class="s0">} </span><span class="s1">catch </span><span class="s0">(error) {}</span>
<span class="s0">}</span>

<span class="s0">async </span><span class="s1">function </span><span class="s0">loadStores() {</span>
  <span class="s1">try </span><span class="s0">{</span>
    <span class="s0">const response = await fetch(</span><span class="s2">&quot;/api/stores&quot;</span><span class="s0">);</span>
    <span class="s0">stores = await response.json();</span>
  <span class="s0">} </span><span class="s1">catch </span><span class="s0">(error) {}</span>
<span class="s0">}</span>

<span class="s0">async </span><span class="s1">function </span><span class="s0">loadCategories() {</span>
  <span class="s1">try </span><span class="s0">{</span>
    <span class="s0">const response = await fetch(</span><span class="s2">&quot;/api/categories&quot;</span><span class="s0">);</span>
    <span class="s0">categories = await response.json();</span>
  <span class="s0">} </span><span class="s1">catch </span><span class="s0">(error) {}</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">setupFilters() {</span>
  <span class="s0">const categoryFilters = document.getElementById(</span><span class="s2">&quot;categoryFilters&quot;</span><span class="s0">);</span>
  <span class="s0">const storeFilters = document.getElementById(</span><span class="s2">&quot;storeFilters&quot;</span><span class="s0">);</span>

  <span class="s1">if </span><span class="s0">(categoryFilters) categoryFilters.innerHTML = </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>
  <span class="s1">if </span><span class="s0">(storeFilters) storeFilters.innerHTML = </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>

  <span class="s1">if </span><span class="s0">(categoryFilters &amp;&amp; categories.length &gt; </span><span class="s3">0</span><span class="s0">) {</span>
    <span class="s0">categories.slice(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">).forEach((category) =&gt; {</span>
      <span class="s0">categoryFilters.innerHTML += `</span>
        <span class="s0">&lt;label class=</span><span class="s2">&quot;filter-option&quot;</span><span class="s0">&gt;</span>
          <span class="s0">&lt;input type=</span><span class="s2">&quot;checkbox&quot; </span><span class="s0">name=</span><span class="s2">&quot;category&quot; </span><span class="s0">value=</span><span class="s2">&quot;${category.id}&quot;</span><span class="s0">&gt;</span>
          <span class="s0">${category.name}</span>
        <span class="s0">&lt;/label&gt;</span>
      <span class="s0">`;</span>
    <span class="s0">});</span>
  <span class="s0">}</span>

  <span class="s1">if </span><span class="s0">(storeFilters &amp;&amp; stores.length &gt; </span><span class="s3">0</span><span class="s0">) {</span>
    <span class="s0">stores.slice(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">).forEach((store) =&gt; {</span>
      <span class="s0">storeFilters.innerHTML += `</span>
        <span class="s0">&lt;label class=</span><span class="s2">&quot;filter-option&quot;</span><span class="s0">&gt;</span>
          <span class="s0">&lt;input type=</span><span class="s2">&quot;checkbox&quot; </span><span class="s0">name=</span><span class="s2">&quot;store&quot; </span><span class="s0">value=</span><span class="s2">&quot;${store.id}&quot;</span><span class="s0">&gt;</span>
          <span class="s0">${store.name}</span>
        <span class="s0">&lt;/label&gt;</span>
      <span class="s0">`;</span>
    <span class="s0">});</span>
  <span class="s0">}</span>

  <span class="s0">const priceRange = document.getElementById(</span><span class="s2">&quot;priceRange&quot;</span><span class="s0">);</span>
  <span class="s0">const priceValue = document.getElementById(</span><span class="s2">&quot;priceValue&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(priceRange &amp;&amp; priceValue) {</span>
    <span class="s0">priceRange.addEventListener(</span><span class="s2">&quot;input&quot;</span><span class="s0">, (e) =&gt; {</span>
      <span class="s0">priceValue.textContent = e.target.value;</span>
      <span class="s0">filters.maxPrice = parseInt(e.target.value, </span><span class="s3">10</span><span class="s0">);</span>
    <span class="s0">});</span>
  <span class="s0">}</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">displayProducts(productsToDisplay) {</span>
  <span class="s0">const productsGrid = document.getElementById(</span><span class="s2">&quot;productsGrid&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(!productsGrid) </span><span class="s1">return</span><span class="s0">;</span>

  <span class="s0">productsGrid.innerHTML = </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>

  <span class="s0">productsToDisplay.forEach((product) =&gt; {</span>
    <span class="s1">if </span><span class="s0">(filters.maxPrice &amp;&amp; product.price &gt; filters.maxPrice) </span><span class="s1">return</span><span class="s0">;</span>
    <span class="s1">if </span><span class="s0">(filters.inStockOnly &amp;&amp; product.stock &lt;= </span><span class="s3">0</span><span class="s0">) </span><span class="s1">return</span><span class="s0">;</span>

    <span class="s0">const productCard = document.createElement(</span><span class="s2">&quot;div&quot;</span><span class="s0">);</span>
    <span class="s0">productCard.className = </span><span class="s2">&quot;product-card&quot;</span><span class="s0">;</span>

    <span class="s0">const badge =</span>
      <span class="s0">product.stock &lt; </span><span class="s3">10 </span><span class="s0">? `&lt;div class=</span><span class="s2">&quot;product-badge&quot;</span><span class="s0">&gt;Low Stock&lt;/div&gt;` : </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>
    <span class="s0">const icon = getCategoryIcon(product.category?.name);</span>

    <span class="s0">productCard.innerHTML = `</span>
      <span class="s0">${badge}</span>
      <span class="s0">&lt;div style=</span><span class="s2">&quot;text-align: center;&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;i class=</span><span class="s2">&quot;${icon}&quot; </span><span class="s0">style=</span><span class="s2">&quot;font-size: 60px; color: #ddd;&quot;</span><span class="s0">&gt;&lt;/i&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;h3 class=</span><span class="s2">&quot;product-title&quot;</span><span class="s0">&gt;${product.name}&lt;/h3&gt;</span>
      <span class="s0">&lt;div class=</span><span class="s2">&quot;product-price&quot;</span><span class="s0">&gt;</span>
        <span class="s0">Rs. ${formatPrice(product.price)}</span>
        <span class="s0">${</span>
          <span class="s0">product.originalPrice</span>
            <span class="s0">? `&lt;span&gt;Rs. ${formatPrice(product.originalPrice)}&lt;/span&gt;`</span>
            <span class="s0">: </span><span class="s2">&quot;&quot;</span>
        <span class="s0">}</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;div class=</span><span class="s2">&quot;product-rating&quot;</span><span class="s0">&gt;</span>
        <span class="s0">${generateStars(Math.random() * </span><span class="s3">2 </span><span class="s0">+ </span><span class="s3">3</span><span class="s0">)}</span>
        <span class="s0">&lt;span style=</span><span class="s2">&quot;color: #565959; font-size: 14px;&quot;</span><span class="s0">&gt;(${Math.floor(</span>
          <span class="s0">Math.random() * </span><span class="s3">100</span>
        <span class="s0">)})&lt;/span&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;div class=</span><span class="s2">&quot;product-store&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;i class=</span><span class="s2">&quot;fas fa-store&quot;</span><span class="s0">&gt;&lt;/i&gt; ${product.store?.name || </span><span class="s2">&quot;Local Store&quot;</span><span class="s0">}</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;div class=</span><span class="s2">&quot;product-stock&quot;</span><span class="s0">&gt;</span>
        <span class="s0">${</span>
          <span class="s0">product.stock &gt; </span><span class="s3">0</span>
            <span class="s0">? `&lt;i class=</span><span class="s2">&quot;fas fa-check-circle&quot; </span><span class="s0">style=</span><span class="s2">&quot;color: green;&quot;</span><span class="s0">&gt;&lt;/i&gt; In Stock (${product.stock} available)`</span>
            <span class="s0">: `&lt;i class=</span><span class="s2">&quot;fas fa-times-circle&quot; </span><span class="s0">style=</span><span class="s2">&quot;color: red;&quot;</span><span class="s0">&gt;&lt;/i&gt; Out of Stock`</span>
        <span class="s0">}</span>
      <span class="s0">&lt;/div&gt;</span>
      <span class="s0">&lt;button class=</span><span class="s2">&quot;add-to-cart-btn&quot; </span><span class="s0">onclick=</span><span class="s2">&quot;addToCart(${product.id})&quot; </span><span class="s0">${</span>
      <span class="s0">product.stock &lt;= </span><span class="s3">0 </span><span class="s0">? </span><span class="s2">&quot;disabled&quot; </span><span class="s0">: </span><span class="s2">&quot;&quot;</span>
    <span class="s0">}&gt;</span>
        <span class="s0">&lt;i class=</span><span class="s2">&quot;fas fa-cart-plus&quot;</span><span class="s0">&gt;&lt;/i&gt; Add to Cart</span>
      <span class="s0">&lt;/button&gt;</span>
    <span class="s0">`;</span>

    <span class="s0">productsGrid.appendChild(productCard);</span>
  <span class="s0">});</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">loadSuggestions() {</span>
  <span class="s0">const suggestionsGrid = document.getElementById(</span><span class="s2">&quot;suggestionsGrid&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(!suggestionsGrid) </span><span class="s1">return</span><span class="s0">;</span>

  <span class="s0">const suggestedProducts = [...products]</span>
    <span class="s0">.sort(() =&gt; Math.random() - </span><span class="s3">0.5</span><span class="s0">)</span>
    <span class="s0">.slice(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">6</span><span class="s0">);</span>

  <span class="s0">suggestionsGrid.innerHTML = </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>
  <span class="s0">suggestedProducts.forEach((product) =&gt; {</span>
    <span class="s0">suggestionsGrid.innerHTML += `</span>
      <span class="s0">&lt;div class=</span><span class="s2">&quot;product-card&quot;</span><span class="s0">&gt;</span>
        <span class="s0">&lt;div style=</span><span class="s2">&quot;text-align: center;&quot;</span><span class="s0">&gt;</span>
          <span class="s0">&lt;i class=</span><span class="s2">&quot;${getCategoryIcon(</span>
            <span class="s0">product.category?.name</span>
          <span class="s0">)}</span><span class="s2">&quot; style=&quot;</span><span class="s0">font-size: </span><span class="s3">40</span><span class="s0">px; color: #ddd;</span><span class="s2">&quot;&gt;&lt;/i&gt;</span>
        <span class="s0">&lt;/div&gt;</span>
        <span class="s0">&lt;h4 style=</span><span class="s2">&quot;font-size: 14px; margin: 10px 0; height: 40px; overflow: hidden;&quot;</span><span class="s0">&gt;${</span>
          <span class="s0">product.name</span>
        <span class="s0">}&lt;/h4&gt;</span>
        <span class="s0">&lt;div style=</span><span class="s2">&quot;color: var(--amazon-price); font-weight: bold; margin-bottom: 10px;&quot;</span><span class="s0">&gt;</span>
          <span class="s0">Rs. ${formatPrice(product.price)}</span>
        <span class="s0">&lt;/div&gt;</span>
        <span class="s0">&lt;button onclick=</span><span class="s2">&quot;addToCart(${product.id})&quot; </span><span class="s0">style=</span><span class="s2">&quot;width: 100%; padding: 5px; background: var(--amazon-light-gray); border: 1px solid var(--amazon-border); border-radius: 4px; cursor: pointer;&quot;</span><span class="s0">&gt;</span>
          <span class="s0">Add to Cart</span>
        <span class="s0">&lt;/button&gt;</span>
      <span class="s0">&lt;/div&gt;</span>
    <span class="s0">`;</span>
  <span class="s0">});</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">addToCart(productId) {</span>
  <span class="s0">const product = products.find((p) =&gt; p.id === productId);</span>
  <span class="s1">if </span><span class="s0">(!product) </span><span class="s1">return</span><span class="s0">;</span>

  <span class="s1">if </span><span class="s0">(product.stock &lt;= </span><span class="s3">0</span><span class="s0">) {</span>
    <span class="s0">alert(</span><span class="s2">&quot;This item is out of stock&quot;</span><span class="s0">);</span>
    <span class="s1">return</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s0">const existingItem = cart.find((item) =&gt; item.productId === productId);</span>

  <span class="s1">if </span><span class="s0">(existingItem) {</span>
    <span class="s1">if </span><span class="s0">(existingItem.quantity &gt;= product.stock) {</span>
      <span class="s0">alert(`Only ${product.stock} items available </span><span class="s1">in </span><span class="s0">stock`);</span>
      <span class="s1">return</span><span class="s0">;</span>
    <span class="s0">}</span>
    <span class="s0">existingItem.quantity++;</span>
  <span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
    <span class="s0">cart.push({</span>
      <span class="s0">productId: product.id,</span>
      <span class="s0">name: product.name,</span>
      <span class="s0">price: product.price,</span>
      <span class="s0">quantity: </span><span class="s3">1</span><span class="s0">,</span>
      <span class="s0">storeId: product.store?.id</span>
    <span class="s0">});</span>
  <span class="s0">}</span>

  <span class="s0">saveCart();</span>
  <span class="s0">updateCartCount();</span>
  <span class="s0">showNotification(`${product.name} added to cart!`);</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">saveCart() {</span>
  <span class="s0">localStorage.setItem(</span><span class="s2">&quot;cart&quot;</span><span class="s0">, JSON.stringify(cart));</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">updateCartCount() {</span>
  <span class="s0">const cartCount = document.getElementById(</span><span class="s2">&quot;cartCount&quot;</span><span class="s0">);</span>
  <span class="s1">if </span><span class="s0">(cartCount) {</span>
    <span class="s0">const totalItems = cart.reduce((sum, item) =&gt; sum + item.quantity, </span><span class="s3">0</span><span class="s0">);</span>
    <span class="s0">cartCount.textContent = totalItems;</span>
  <span class="s0">}</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">applyFilters() {</span>
  <span class="s0">const selectedCategories = Array.from(</span>
    <span class="s0">document.querySelectorAll(</span><span class="s2">'input[name=&quot;category&quot;]:checked'</span><span class="s0">)</span>
  <span class="s0">).map((cb) =&gt; parseInt(cb.value, </span><span class="s3">10</span><span class="s0">));</span>

  <span class="s0">const selectedStores = Array.from(</span>
    <span class="s0">document.querySelectorAll(</span><span class="s2">'input[name=&quot;store&quot;]:checked'</span><span class="s0">)</span>
  <span class="s0">).map((cb) =&gt; parseInt(cb.value, </span><span class="s3">10</span><span class="s0">));</span>

  <span class="s0">const inStockOnly = document.getElementById(</span><span class="s2">&quot;inStockOnly&quot;</span><span class="s0">)?.checked || </span><span class="s1">false</span><span class="s0">;</span>
  <span class="s0">filters.inStockOnly = inStockOnly;</span>

  <span class="s0">let filteredProducts = products.filter((product) =&gt; {</span>
    <span class="s1">if </span><span class="s0">(product.price &gt; filters.maxPrice) </span><span class="s1">return false</span><span class="s0">;</span>
    <span class="s1">if </span><span class="s0">(inStockOnly &amp;&amp; product.stock &lt;= </span><span class="s3">0</span><span class="s0">) </span><span class="s1">return false</span><span class="s0">;</span>

    <span class="s1">if </span><span class="s0">(selectedCategories.length &gt; </span><span class="s3">0 </span><span class="s0">&amp;&amp; product.category) {</span>
      <span class="s1">if </span><span class="s0">(!selectedCategories.includes(product.category.id)) </span><span class="s1">return false</span><span class="s0">;</span>
    <span class="s0">}</span>

    <span class="s1">if </span><span class="s0">(selectedStores.length &gt; </span><span class="s3">0 </span><span class="s0">&amp;&amp; product.store) {</span>
      <span class="s1">if </span><span class="s0">(!selectedStores.includes(product.store.id)) </span><span class="s1">return false</span><span class="s0">;</span>
    <span class="s0">}</span>

    <span class="s1">if </span><span class="s0">(filters.searchQuery) {</span>
      <span class="s0">const query = filters.searchQuery.toLowerCase();</span>
      <span class="s0">const nameMatch = product.name?.toLowerCase().includes(query);</span>
      <span class="s0">const categoryMatch = product.category?.name</span>
        <span class="s0">?.toLowerCase()</span>
        <span class="s0">.includes(query);</span>
      <span class="s1">if </span><span class="s0">(!nameMatch &amp;&amp; !categoryMatch) </span><span class="s1">return false</span><span class="s0">;</span>
    <span class="s0">}</span>

    <span class="s1">return true</span><span class="s0">;</span>
  <span class="s0">});</span>

  <span class="s0">displayProducts(filteredProducts);</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">searchProducts() {</span>
  <span class="s0">const headerInput = document.getElementById(</span><span class="s2">&quot;searchInput&quot;</span><span class="s0">);</span>
  <span class="s0">const heroInput = document.getElementById(</span><span class="s2">&quot;heroSearchInput&quot;</span><span class="s0">);</span>
  <span class="s0">const value = (headerInput?.value || heroInput?.value || </span><span class="s2">&quot;&quot;</span><span class="s0">).trim();</span>
  <span class="s0">filters.searchQuery = value;</span>
  <span class="s0">applyFilters();</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">sortProducts() {</span>
  <span class="s0">const sortBy = document.getElementById(</span><span class="s2">&quot;sortBy&quot;</span><span class="s0">)?.value || </span><span class="s2">&quot;default&quot;</span><span class="s0">;</span>
  <span class="s0">let sortedProducts = [...products];</span>

  <span class="s1">switch </span><span class="s0">(sortBy) {</span>
    <span class="s1">case </span><span class="s2">&quot;price_asc&quot;</span><span class="s0">:</span>
      <span class="s0">sortedProducts.sort((a, b) =&gt; a.price - b.price);</span>
      <span class="s1">break</span><span class="s0">;</span>
    <span class="s1">case </span><span class="s2">&quot;price_desc&quot;</span><span class="s0">:</span>
      <span class="s0">sortedProducts.sort((a, b) =&gt; b.price - a.price);</span>
      <span class="s1">break</span><span class="s0">;</span>
    <span class="s1">case </span><span class="s2">&quot;name&quot;</span><span class="s0">:</span>
      <span class="s0">sortedProducts.sort((a, b) =&gt; (a.name || </span><span class="s2">&quot;&quot;</span><span class="s0">).localeCompare(b.name || </span><span class="s2">&quot;&quot;</span><span class="s0">));</span>
      <span class="s1">break</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s0">displayProducts(sortedProducts);</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">formatPrice(price) {</span>
  <span class="s0">const n = Number(price || </span><span class="s3">0</span><span class="s0">);</span>
  <span class="s1">return </span><span class="s0">n.toFixed(</span><span class="s3">2</span><span class="s0">).replace(/\B(?=(\d{</span><span class="s3">3</span><span class="s0">})+(?!\d))/g, </span><span class="s2">&quot;,&quot;</span><span class="s0">);</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">generateStars(rating) {</span>
  <span class="s0">let stars = </span><span class="s2">&quot;&quot;</span><span class="s0">;</span>
  <span class="s1">for </span><span class="s0">(let i = </span><span class="s3">1</span><span class="s0">; i &lt;= </span><span class="s3">5</span><span class="s0">; i++) {</span>
    <span class="s1">if </span><span class="s0">(i &lt;= Math.floor(rating)) stars += </span><span class="s2">'&lt;i class=&quot;fas fa-star&quot;&gt;&lt;/i&gt;'</span><span class="s0">;</span>
    <span class="s1">else if </span><span class="s0">(i === Math.ceil(rating) &amp;&amp; !Number.isInteger(rating))</span>
      <span class="s0">stars += </span><span class="s2">'&lt;i class=&quot;fas fa-star-half-alt&quot;&gt;&lt;/i&gt;'</span><span class="s0">;</span>
    <span class="s1">else </span><span class="s0">stars += </span><span class="s2">'&lt;i class=&quot;far fa-star&quot;&gt;&lt;/i&gt;'</span><span class="s0">;</span>
  <span class="s0">}</span>
  <span class="s1">return </span><span class="s0">stars;</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">getCategoryIcon(categoryName) {</span>
  <span class="s0">const icons = {</span>
    <span class="s0">Fruits: </span><span class="s2">&quot;fas fa-apple-alt&quot;</span><span class="s0">,</span>
    <span class="s0">Vegetables: </span><span class="s2">&quot;fas fa-carrot&quot;</span><span class="s0">,</span>
    <span class="s0">Dairy: </span><span class="s2">&quot;fas fa-cheese&quot;</span><span class="s0">,</span>
    <span class="s0">Bakery: </span><span class="s2">&quot;fas fa-bread-slice&quot;</span><span class="s0">,</span>
    <span class="s0">Meat: </span><span class="s2">&quot;fas fa-drumstick-bite&quot;</span><span class="s0">,</span>
    <span class="s0">Seafood: </span><span class="s2">&quot;fas fa-fish&quot;</span><span class="s0">,</span>
    <span class="s0">Beverages: </span><span class="s2">&quot;fas fa-wine-bottle&quot;</span><span class="s0">,</span>
    <span class="s0">Snacks: </span><span class="s2">&quot;fas fa-cookie&quot;</span><span class="s0">,</span>
    <span class="s0">Rice: </span><span class="s2">&quot;fas fa-seedling&quot;</span><span class="s0">,</span>
    <span class="s0">Oil: </span><span class="s2">&quot;fas fa-oil-can&quot;</span>
  <span class="s0">};</span>

  <span class="s1">if </span><span class="s0">(!categoryName) </span><span class="s1">return </span><span class="s2">&quot;fas fa-shopping-basket&quot;</span><span class="s0">;</span>

  <span class="s1">for </span><span class="s0">(const [key, icon] of Object.entries(icons)) {</span>
    <span class="s1">if </span><span class="s0">(categoryName.toLowerCase().includes(key.toLowerCase())) </span><span class="s1">return </span><span class="s0">icon;</span>
  <span class="s0">}</span>
  <span class="s1">return </span><span class="s2">&quot;fas fa-shopping-basket&quot;</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s1">function </span><span class="s0">showNotification(message) {</span>
  <span class="s0">const notification = document.createElement(</span><span class="s2">&quot;div&quot;</span><span class="s0">);</span>
  <span class="s0">notification.style.cssText = `</span>
    <span class="s0">position: fixed;</span>
    <span class="s0">top: </span><span class="s3">80</span><span class="s0">px;</span>
    <span class="s0">right: </span><span class="s3">20</span><span class="s0">px;</span>
    <span class="s0">background: </span><span class="s1">var</span><span class="s0">(--amazon-green);</span>
    <span class="s0">color: white;</span>
    <span class="s0">padding: </span><span class="s3">15</span><span class="s0">px </span><span class="s3">20</span><span class="s0">px;</span>
    <span class="s0">border-radius: </span><span class="s3">4</span><span class="s0">px;</span>
    <span class="s0">z-index: </span><span class="s3">1000</span><span class="s0">;</span>
    <span class="s0">animation: slideIn </span><span class="s3">0</span><span class="s0">.</span><span class="s3">3</span><span class="s0">s ease;</span>
  <span class="s0">`;</span>
  <span class="s0">notification.textContent = message;</span>
  <span class="s0">document.body.appendChild(notification);</span>

  <span class="s0">setTimeout(() =&gt; {</span>
    <span class="s0">notification.style.animation = </span><span class="s2">&quot;slideOut 0.3s ease&quot;</span><span class="s0">;</span>
    <span class="s0">setTimeout(() =&gt; notification.remove(), </span><span class="s3">300</span><span class="s0">);</span>
  <span class="s0">}, </span><span class="s3">2000</span><span class="s0">);</span>
<span class="s0">}</span>

<span class="s0">(</span><span class="s1">function </span><span class="s0">() {</span>
  <span class="s1">if </span><span class="s0">(document.getElementById(</span><span class="s2">&quot;amazonAnimStyles&quot;</span><span class="s0">)) </span><span class="s1">return</span><span class="s0">;</span>
  <span class="s0">const style = document.createElement(</span><span class="s2">&quot;style&quot;</span><span class="s0">);</span>
  <span class="s0">style.id = </span><span class="s2">&quot;amazonAnimStyles&quot;</span><span class="s0">;</span>
  <span class="s0">style.textContent = `</span>
    <span class="s0">@keyframes slideIn {</span>
      <span class="s0">from { transform: translateX(</span><span class="s3">100</span><span class="s0">%); opacity: </span><span class="s3">0</span><span class="s0">; }</span>
      <span class="s0">to { transform: translateX(</span><span class="s3">0</span><span class="s0">); opacity: </span><span class="s3">1</span><span class="s0">; }</span>
    <span class="s0">}</span>
    <span class="s0">@keyframes slideOut {</span>
      <span class="s0">from { transform: translateX(</span><span class="s3">0</span><span class="s0">); opacity: </span><span class="s3">1</span><span class="s0">; }</span>
      <span class="s0">to { transform: translateX(</span><span class="s3">100</span><span class="s0">%); opacity: </span><span class="s3">0</span><span class="s0">; }</span>
    <span class="s0">}</span>
  <span class="s0">`;</span>
  <span class="s0">document.head.appendChild(style);</span>
<span class="s0">})();</span>
</pre>
</body>
</html>