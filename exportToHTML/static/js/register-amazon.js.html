<html>
<head>
<title>register-amazon.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
register-amazon.js</font>
</center></td></tr></table>
<pre><span class="s0">// Amazon-style Registration JavaScript</span>
<span class="s1">let selectedRole = </span><span class="s2">'CUSTOMER'</span><span class="s1">;</span>

<span class="s1">document.addEventListener(</span><span class="s2">'DOMContentLoaded'</span><span class="s1">, () =&gt; {</span>
    <span class="s0">// Setup password toggles</span>
    <span class="s1">setupPasswordToggles();</span>

    <span class="s0">// Setup form submission</span>
    <span class="s1">setupRegistrationForm();</span>
<span class="s1">});</span>

<span class="s3">function </span><span class="s1">setupPasswordToggles() {</span>
    <span class="s0">// Setup for password field</span>
    <span class="s1">const togglePassword = document.getElementById(</span><span class="s2">'togglePassword'</span><span class="s1">);</span>
    <span class="s1">const passwordInput = document.getElementById(</span><span class="s2">'password'</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(togglePassword &amp;&amp; passwordInput) {</span>
        <span class="s1">togglePassword.addEventListener(</span><span class="s2">'click'</span><span class="s1">, () =&gt; {</span>
            <span class="s1">const type = passwordInput.getAttribute(</span><span class="s2">'type'</span><span class="s1">) === </span><span class="s2">'password' </span><span class="s1">? </span><span class="s2">'text' </span><span class="s1">: </span><span class="s2">'password'</span><span class="s1">;</span>
            <span class="s1">passwordInput.setAttribute(</span><span class="s2">'type'</span><span class="s1">, type);</span>

            <span class="s1">const icon = togglePassword.querySelector(</span><span class="s2">'i'</span><span class="s1">);</span>
            <span class="s1">icon.className = type === </span><span class="s2">'password' </span><span class="s1">? </span><span class="s2">'fas fa-eye' </span><span class="s1">: </span><span class="s2">'fas fa-eye-slash'</span><span class="s1">;</span>
        <span class="s1">});</span>
    <span class="s1">}</span>

    <span class="s0">// Setup for confirm password field</span>
    <span class="s1">const toggleConfirmPassword = document.getElementById(</span><span class="s2">'toggleConfirmPassword'</span><span class="s1">);</span>
    <span class="s1">const confirmPasswordInput = document.getElementById(</span><span class="s2">'confirmPassword'</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(toggleConfirmPassword &amp;&amp; confirmPasswordInput) {</span>
        <span class="s1">toggleConfirmPassword.addEventListener(</span><span class="s2">'click'</span><span class="s1">, () =&gt; {</span>
            <span class="s1">const type = confirmPasswordInput.getAttribute(</span><span class="s2">'type'</span><span class="s1">) === </span><span class="s2">'password' </span><span class="s1">? </span><span class="s2">'text' </span><span class="s1">: </span><span class="s2">'password'</span><span class="s1">;</span>
            <span class="s1">confirmPasswordInput.setAttribute(</span><span class="s2">'type'</span><span class="s1">, type);</span>

            <span class="s1">const icon = toggleConfirmPassword.querySelector(</span><span class="s2">'i'</span><span class="s1">);</span>
            <span class="s1">icon.className = type === </span><span class="s2">'password' </span><span class="s1">? </span><span class="s2">'fas fa-eye' </span><span class="s1">: </span><span class="s2">'fas fa-eye-slash'</span><span class="s1">;</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">setupRegistrationForm() {</span>
    <span class="s1">const registerButton = document.getElementById(</span><span class="s2">'registerButton'</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(registerButton) {</span>
        <span class="s1">registerButton.addEventListener(</span><span class="s2">'click'</span><span class="s1">, handleRegistration);</span>
    <span class="s1">}</span>

    <span class="s0">// Allow Enter key in any field to submit</span>
    <span class="s1">const inputs = document.querySelectorAll(</span><span class="s2">'.form-input'</span><span class="s1">);</span>
    <span class="s1">inputs.forEach(input =&gt; {</span>
        <span class="s1">input.addEventListener(</span><span class="s2">'keypress'</span><span class="s1">, (e) =&gt; {</span>
            <span class="s3">if </span><span class="s1">(e.key === </span><span class="s2">'Enter'</span><span class="s1">) handleRegistration();</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">selectRole(role) {</span>
    <span class="s1">selectedRole = role;</span>
    <span class="s1">document.getElementById(</span><span class="s2">'role'</span><span class="s1">).value = role;</span>

    <span class="s0">// Update UI</span>
    <span class="s1">document.querySelectorAll(</span><span class="s2">'.role-option'</span><span class="s1">).forEach(option =&gt; {</span>
        <span class="s3">if </span><span class="s1">(option.dataset.role === role) {</span>
            <span class="s1">option.classList.add(</span><span class="s2">'selected'</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s1">option.classList.remove(</span><span class="s2">'selected'</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s1">async </span><span class="s3">function </span><span class="s1">handleRegistration() {</span>
    <span class="s1">const name = document.getElementById(</span><span class="s2">'name'</span><span class="s1">).value.trim();</span>
    <span class="s1">const email = document.getElementById(</span><span class="s2">'email'</span><span class="s1">).value.trim();</span>
    <span class="s1">const password = document.getElementById(</span><span class="s2">'password'</span><span class="s1">).value;</span>
    <span class="s1">const confirmPassword = document.getElementById(</span><span class="s2">'confirmPassword'</span><span class="s1">).value;</span>
    <span class="s1">const registerButton = document.getElementById(</span><span class="s2">'registerButton'</span><span class="s1">);</span>

    <span class="s0">// Clear previous errors</span>
    <span class="s1">clearErrors();</span>

    <span class="s0">// Validate inputs</span>
    <span class="s1">let isValid = </span><span class="s3">true</span><span class="s1">;</span>

    <span class="s3">if </span><span class="s1">(!name) {</span>
        <span class="s1">showError(</span><span class="s2">'nameError'</span><span class="s1">, </span><span class="s2">'Enter your name'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(!email) {</span>
        <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'Enter your email'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!isValidEmail(email)) {</span>
        <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'Enter a valid email address'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(!password) {</span>
        <span class="s1">showError(</span><span class="s2">'passwordError'</span><span class="s1">, </span><span class="s2">'Enter a password'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(password.length &lt; </span><span class="s4">6</span><span class="s1">) {</span>
        <span class="s1">showError(</span><span class="s2">'passwordError'</span><span class="s1">, </span><span class="s2">'Password must be at least 6 characters'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(password !== confirmPassword) {</span>
        <span class="s1">showError(</span><span class="s2">'confirmPasswordError'</span><span class="s1">, </span><span class="s2">'Passwords do not match'</span><span class="s1">);</span>
        <span class="s1">isValid = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(!isValid) </span><span class="s3">return</span><span class="s1">;</span>

    <span class="s0">// Show loading state</span>
    <span class="s1">registerButton.classList.add(</span><span class="s2">'loading'</span><span class="s1">);</span>
    <span class="s1">registerButton.disabled = </span><span class="s3">true</span><span class="s1">;</span>

    <span class="s3">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s2">'/api/auth/register'</span><span class="s1">, {</span>
            <span class="s1">method: </span><span class="s2">'POST'</span><span class="s1">,</span>
            <span class="s1">headers: {</span>
                <span class="s2">'Content-Type'</span><span class="s1">: </span><span class="s2">'application/json'</span>
            <span class="s1">},</span>
            <span class="s1">body: JSON.stringify({</span>
                <span class="s1">name: name,</span>
                <span class="s1">email: email,</span>
                <span class="s1">password: password,</span>
                <span class="s1">role: selectedRole</span>
            <span class="s1">})</span>
        <span class="s1">});</span>

        <span class="s3">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const user = await response.json();</span>

            <span class="s0">// Show success message</span>
            <span class="s1">showSuccess(</span><span class="s2">'Account created successfully! Redirecting to login...'</span><span class="s1">);</span>

            <span class="s0">// Redirect to login page after 2 seconds</span>
            <span class="s1">setTimeout(() =&gt; {</span>
                <span class="s1">window.location.href = </span><span class="s2">'/login-amazon.html'</span><span class="s1">;</span>
            <span class="s1">}, </span><span class="s4">2000</span><span class="s1">);</span>

        <span class="s1">} </span><span class="s3">else if </span><span class="s1">(response.status === </span><span class="s4">409</span><span class="s1">) {</span>
            <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'An account with this email already exists'</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s1">const error = await response.text();</span>
            <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'Registration failed. Please try again.'</span><span class="s1">);</span>
        <span class="s1">}</span>

    <span class="s1">} </span><span class="s3">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s2">'Registration error:'</span><span class="s1">, error);</span>
        <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'Network error. Please try again.'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">finally </span><span class="s1">{</span>
        <span class="s0">// Reset loading state</span>
        <span class="s1">registerButton.classList.remove(</span><span class="s2">'loading'</span><span class="s1">);</span>
        <span class="s1">registerButton.disabled = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">isValidEmail(email) {</span>
    <span class="s1">const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;</span>
    <span class="s3">return </span><span class="s1">emailRegex.test(email);</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">showError(elementId, message) {</span>
    <span class="s1">const element = document.getElementById(elementId);</span>
    <span class="s3">if </span><span class="s1">(element) {</span>
        <span class="s1">element.textContent = message;</span>
        <span class="s1">element.style.display = </span><span class="s2">'block'</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">showSuccess(message) {</span>
    <span class="s0">// Create success toast</span>
    <span class="s1">const toast = document.createElement(</span><span class="s2">'div'</span><span class="s1">);</span>
    <span class="s1">toast.style.cssText = `</span>
        <span class="s1">position: fixed;</span>
        <span class="s1">top: </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">right: </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">background: </span><span class="s3">var</span><span class="s1">(--amazon-green);</span>
        <span class="s1">color: white;</span>
        <span class="s1">padding: </span><span class="s4">15</span><span class="s1">px </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">border-radius: </span><span class="s4">4</span><span class="s1">px;</span>
        <span class="s1">z-index: </span><span class="s4">1000</span><span class="s1">;</span>
        <span class="s1">animation: slideIn </span><span class="s4">0</span><span class="s1">.</span><span class="s4">3</span><span class="s1">s ease;</span>
    <span class="s1">`;</span>
    <span class="s1">toast.textContent = message;</span>
    <span class="s1">document.body.appendChild(toast);</span>

    <span class="s1">setTimeout(() =&gt; {</span>
        <span class="s1">toast.remove();</span>
    <span class="s1">}, </span><span class="s4">3000</span><span class="s1">);</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">clearErrors() {</span>
    <span class="s1">const errors = document.querySelectorAll(</span><span class="s2">'.error-message'</span><span class="s1">);</span>
    <span class="s1">errors.forEach(error =&gt; {</span>
        <span class="s1">error.style.display = </span><span class="s2">'none'</span><span class="s1">;</span>
    <span class="s1">});</span>
<span class="s1">}</span></pre>
</body>
</html>