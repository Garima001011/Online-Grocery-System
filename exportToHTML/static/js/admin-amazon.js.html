<html>
<head>
<title>admin-amazon.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
admin-amazon.js</font>
</center></td></tr></table>
<pre><span class="s0">// Admin Dashboard JavaScript</span>
<span class="s1">let currentUser = </span><span class="s2">null</span><span class="s1">;</span>
<span class="s1">let dashboardData = </span><span class="s2">null</span><span class="s1">;</span>
<span class="s1">let chartInstances = {};</span>
<span class="s1">let currentView = </span><span class="s3">'dashboard'</span><span class="s1">;</span>

<span class="s0">// Initialize</span>
<span class="s1">document.addEventListener(</span><span class="s3">'DOMContentLoaded'</span><span class="s1">, () =&gt; {</span>
    <span class="s1">currentUser = JSON.parse(localStorage.getItem(</span><span class="s3">'user'</span><span class="s1">));</span>
    
    <span class="s0">// Check if user is admin</span>
    <span class="s2">if </span><span class="s1">(!currentUser || currentUser.role !== </span><span class="s3">'ADMIN'</span><span class="s1">) {</span>
        <span class="s1">window.location.href = </span><span class="s3">'/login-amazon.html'</span><span class="s1">;</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    
    <span class="s1">initAdminDashboard();</span>
<span class="s1">});</span>

<span class="s1">async </span><span class="s2">function </span><span class="s1">initAdminDashboard() {</span>
    <span class="s0">// Set user info</span>
    <span class="s1">document.getElementById(</span><span class="s3">'adminName'</span><span class="s1">).textContent = currentUser.name || currentUser.email;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'adminRole'</span><span class="s1">).textContent = currentUser.role;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'adminAvatar'</span><span class="s1">).textContent = currentUser.name?.charAt(</span><span class="s4">0</span><span class="s1">) || currentUser.email.charAt(</span><span class="s4">0</span><span class="s1">);</span>
    
    <span class="s0">// Initialize date pickers</span>
    <span class="s1">flatpickr(</span><span class="s3">&quot;#notificationSchedule&quot;</span><span class="s1">, {</span>
        <span class="s1">enableTime: </span><span class="s2">true</span><span class="s1">,</span>
        <span class="s1">dateFormat: </span><span class="s3">&quot;Y-m-d H:i&quot;</span><span class="s1">,</span>
    <span class="s1">});</span>
    
    <span class="s1">flatpickr(</span><span class="s3">&quot;#analyticsStartDate&quot;</span><span class="s1">, {</span>
        <span class="s1">dateFormat: </span><span class="s3">&quot;Y-m-d&quot;</span><span class="s1">,</span>
        <span class="s1">defaultDate: </span><span class="s2">new </span><span class="s1">Date().toISOString().split(</span><span class="s3">'T'</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">});</span>
    
    <span class="s1">flatpickr(</span><span class="s3">&quot;#analyticsEndDate&quot;</span><span class="s1">, {</span>
        <span class="s1">dateFormat: </span><span class="s3">&quot;Y-m-d&quot;</span><span class="s1">,</span>
        <span class="s1">defaultDate: </span><span class="s2">new </span><span class="s1">Date().toISOString().split(</span><span class="s3">'T'</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">});</span>
    
    <span class="s0">// Setup navigation</span>
    <span class="s1">setupNavigation();</span>
    
    <span class="s0">// Load dashboard data</span>
    <span class="s1">await loadDashboardData();</span>
    
    <span class="s0">// Load initial tab content</span>
    <span class="s1">loadTabContent(</span><span class="s3">'dashboard'</span><span class="s1">);</span>
    
    <span class="s0">// Setup real-time updates</span>
    <span class="s1">setupRealtimeUpdates();</span>
<span class="s1">}</span>

<span class="s0">// Setup navigation</span>
<span class="s2">function </span><span class="s1">setupNavigation() {</span>
    <span class="s0">// Sidebar navigation</span>
    <span class="s1">document.querySelectorAll(</span><span class="s3">'.nav-item-admin'</span><span class="s1">).forEach(item =&gt; {</span>
        <span class="s1">item.addEventListener(</span><span class="s3">'click'</span><span class="s1">, </span><span class="s2">function</span><span class="s1">(e) {</span>
            <span class="s1">e.preventDefault();</span>
            
            <span class="s0">// Remove active class from all items</span>
            <span class="s1">document.querySelectorAll(</span><span class="s3">'.nav-item-admin'</span><span class="s1">).forEach(i =&gt; {</span>
                <span class="s1">i.classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
            <span class="s1">});</span>
            
            <span class="s0">// Add active class to clicked item</span>
            <span class="s2">this</span><span class="s1">.classList.add(</span><span class="s3">'active'</span><span class="s1">);</span>
            
            <span class="s0">// Get tab name</span>
            <span class="s1">const tab = </span><span class="s2">this</span><span class="s1">.getAttribute(</span><span class="s3">'data-tab'</span><span class="s1">);</span>
            <span class="s1">currentView = tab;</span>
            
            <span class="s0">// Update page title</span>
            <span class="s1">document.getElementById(</span><span class="s3">'pageTitle'</span><span class="s1">).textContent = </span>
                <span class="s2">this</span><span class="s1">.querySelector(</span><span class="s3">'.nav-text'</span><span class="s1">).textContent + </span><span class="s3">' - Admin Panel'</span><span class="s1">;</span>
            
            <span class="s0">// Load tab content</span>
            <span class="s1">loadTabContent(tab);</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
    
    <span class="s0">// Tab navigation</span>
    <span class="s1">document.querySelectorAll(</span><span class="s3">'.admin-tab'</span><span class="s1">).forEach(tab =&gt; {</span>
        <span class="s1">tab.addEventListener(</span><span class="s3">'click'</span><span class="s1">, </span><span class="s2">function</span><span class="s1">() {</span>
            <span class="s1">const parent = </span><span class="s2">this</span><span class="s1">.closest(</span><span class="s3">'.admin-tabs'</span><span class="s1">);</span>
            <span class="s1">parent.querySelectorAll(</span><span class="s3">'.admin-tab'</span><span class="s1">).forEach(t =&gt; {</span>
                <span class="s1">t.classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
            <span class="s1">});</span>
            <span class="s2">this</span><span class="s1">.classList.add(</span><span class="s3">'active'</span><span class="s1">);</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Load tab content</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadTabContent(tab) {</span>
    <span class="s0">// Hide all tab contents</span>
    <span class="s1">document.querySelectorAll(</span><span class="s3">'.tab-content'</span><span class="s1">).forEach(content =&gt; {</span>
        <span class="s1">content.classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
    <span class="s1">});</span>
    
    <span class="s0">// Show selected tab</span>
    <span class="s1">document.getElementById(tab).classList.add(</span><span class="s3">'active'</span><span class="s1">);</span>
    
    <span class="s0">// Load specific content</span>
    <span class="s2">switch</span><span class="s1">(tab) {</span>
        <span class="s2">case </span><span class="s3">'dashboard'</span><span class="s1">:</span>
            <span class="s1">await loadDashboard();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'returns'</span><span class="s1">:</span>
            <span class="s1">await loadReturns();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'orders'</span><span class="s1">:</span>
            <span class="s1">await loadOrders();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'delivery'</span><span class="s1">:</span>
            <span class="s1">await loadDelivery();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'catalog'</span><span class="s1">:</span>
            <span class="s1">await loadCatalog();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'marketing'</span><span class="s1">:</span>
            <span class="s1">await loadMarketing();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'analytics'</span><span class="s1">:</span>
            <span class="s1">await loadAnalytics();</span>
            <span class="s2">break</span><span class="s1">;</span>
        <span class="s2">case </span><span class="s3">'users'</span><span class="s1">:</span>
            <span class="s1">await loadUsers();</span>
            <span class="s2">break</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Load dashboard data</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadDashboardData() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/dashboard'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">dashboardData = await response.json();</span>
            <span class="s1">updateDashboardStats();</span>
            <span class="s1">updateSidebarStats();</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading dashboard data:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Update dashboard stats</span>
<span class="s2">function </span><span class="s1">updateDashboardStats() {</span>
    <span class="s2">if </span><span class="s1">(!dashboardData) </span><span class="s2">return</span><span class="s1">;</span>
    
    <span class="s1">const stats = dashboardData.stats || {};</span>
    
    <span class="s0">// Update stat cards</span>
    <span class="s1">document.getElementById(</span><span class="s3">'totalRevenue'</span><span class="s1">).textContent = `Rs. ${formatPrice(stats.totalRevenue || </span><span class="s4">0</span><span class="s1">)}`;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'totalOrders'</span><span class="s1">).textContent = stats.totalOrders || </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'totalCustomers'</span><span class="s1">).textContent = stats.totalCustomers || </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'totalReturns'</span><span class="s1">).textContent = stats.pendingReturns || </span><span class="s4">0</span><span class="s1">;</span>
    
    <span class="s0">// Update trends</span>
    <span class="s1">document.getElementById(</span><span class="s3">'revenueTrend'</span><span class="s1">).textContent = `+${stats.revenueGrowth || </span><span class="s4">0</span><span class="s1">}%`;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'ordersTrend'</span><span class="s1">).textContent = `+${stats.orderGrowth || </span><span class="s4">0</span><span class="s1">}%`;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'customersTrend'</span><span class="s1">).textContent = `+${stats.customerGrowth || </span><span class="s4">0</span><span class="s1">}%`;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'returnsTrend'</span><span class="s1">).textContent = `${stats.returnRate || </span><span class="s4">0</span><span class="s1">}%`;</span>
    
    <span class="s0">// Update returns badge</span>
    <span class="s1">const returnsBadge = document.getElementById(</span><span class="s3">'returnsBadge'</span><span class="s1">);</span>
    <span class="s2">if </span><span class="s1">(stats.pendingReturns &gt; </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s1">returnsBadge.textContent = stats.pendingReturns;</span>
        <span class="s1">returnsBadge.style.display = </span><span class="s3">'block'</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Update sidebar stats</span>
<span class="s2">function </span><span class="s1">updateSidebarStats() {</span>
    <span class="s2">if </span><span class="s1">(!dashboardData) </span><span class="s2">return</span><span class="s1">;</span>
    
    <span class="s1">const today = dashboardData.todayStats || {};</span>
    <span class="s1">document.getElementById(</span><span class="s3">'sidebarSales'</span><span class="s1">).textContent = `Rs. ${formatPrice(today.sales || </span><span class="s4">0</span><span class="s1">)}`;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'sidebarOrders'</span><span class="s1">).textContent = today.orders || </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s1">document.getElementById(</span><span class="s3">'sidebarCustomers'</span><span class="s1">).textContent = today.customers || </span><span class="s4">0</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">// Load dashboard content</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadDashboard() {</span>
    <span class="s1">await loadRecentOrders();</span>
    <span class="s1">await loadCharts();</span>
<span class="s1">}</span>

<span class="s0">// Load recent orders</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadRecentOrders() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/orders/recent?limit=10'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const orders = await response.json();</span>
            <span class="s1">renderRecentOrders(orders);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading recent orders:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Render recent orders</span>
<span class="s2">function </span><span class="s1">renderRecentOrders(orders) {</span>
    <span class="s1">const tbody = document.querySelector(</span><span class="s3">'#recentOrdersTable tbody'</span><span class="s1">);</span>
    <span class="s1">tbody.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s1">orders.forEach(order =&gt; {</span>
        <span class="s1">const row = document.createElement(</span><span class="s3">'tr'</span><span class="s1">);</span>
        <span class="s1">row.innerHTML = `</span>
            <span class="s1">&lt;td&gt;&lt;strong&gt;#${order.id}&lt;/strong&gt;&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;</span>
                <span class="s1">&lt;div&gt;${order.user?.name || </span><span class="s3">'Unknown'</span><span class="s1">}&lt;/div&gt;</span>
                <span class="s1">&lt;small class=</span><span class="s3">&quot;text-muted&quot;</span><span class="s1">&gt;${order.user?.email || </span><span class="s3">''</span><span class="s1">}&lt;/small&gt;</span>
            <span class="s1">&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;Rs. ${formatPrice(order.total)}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;&lt;span class=</span><span class="s3">&quot;status-badge-admin status-${order.status.toLowerCase()}&quot;</span><span class="s1">&gt;${order.status}&lt;/span&gt;&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;${formatDate(order.createdAt)}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;</span>
                <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-edit&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;viewOrderDetails(${order.id})&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-eye&quot;</span><span class="s1">&gt;&lt;/i&gt;</span>
                <span class="s1">&lt;/button&gt;</span>
            <span class="s1">&lt;/td&gt;</span>
        <span class="s1">`;</span>
        <span class="s1">tbody.appendChild(row);</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Load and render charts</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadCharts() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s0">// Sales chart</span>
        <span class="s1">const salesResponse = await fetch(</span><span class="s3">'/api/admin/charts/sales?days=7'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(salesResponse.ok) {</span>
            <span class="s1">const salesData = await salesResponse.json();</span>
            <span class="s1">renderSalesChart(salesData);</span>
        <span class="s1">}</span>
        
        <span class="s0">// Orders chart</span>
        <span class="s1">const ordersResponse = await fetch(</span><span class="s3">'/api/admin/charts/orders-by-status'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(ordersResponse.ok) {</span>
            <span class="s1">const ordersData = await ordersResponse.json();</span>
            <span class="s1">renderOrdersChart(ordersData);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading charts:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Render sales chart</span>
<span class="s2">function </span><span class="s1">renderSalesChart(data) {</span>
    <span class="s1">const ctx = document.getElementById(</span><span class="s3">'salesChart'</span><span class="s1">).getContext(</span><span class="s3">'2d'</span><span class="s1">);</span>
    
    <span class="s2">if </span><span class="s1">(chartInstances.salesChart) {</span>
        <span class="s1">chartInstances.salesChart.destroy();</span>
    <span class="s1">}</span>
    
    <span class="s1">chartInstances.salesChart = </span><span class="s2">new </span><span class="s1">Chart(ctx, {</span>
        <span class="s1">type: </span><span class="s3">'line'</span><span class="s1">,</span>
        <span class="s1">data: {</span>
            <span class="s1">labels: data.labels || [],</span>
            <span class="s1">datasets: [{</span>
                <span class="s1">label: </span><span class="s3">'Sales (Rs.)'</span><span class="s1">,</span>
                <span class="s1">data: data.values || [],</span>
                <span class="s1">borderColor: </span><span class="s3">'#ff9900'</span><span class="s1">,</span>
                <span class="s1">backgroundColor: </span><span class="s3">'rgba(255, 153, 0, 0.1)'</span><span class="s1">,</span>
                <span class="s1">borderWidth: </span><span class="s4">2</span><span class="s1">,</span>
                <span class="s1">fill: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">tension: </span><span class="s4">0.4</span>
            <span class="s1">}]</span>
        <span class="s1">},</span>
        <span class="s1">options: {</span>
            <span class="s1">responsive: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">maintainAspectRatio: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">plugins: {</span>
                <span class="s1">legend: {</span>
                    <span class="s1">display: </span><span class="s2">false</span>
                <span class="s1">}</span>
            <span class="s1">},</span>
            <span class="s1">scales: {</span>
                <span class="s1">y: {</span>
                    <span class="s1">beginAtZero: </span><span class="s2">true</span><span class="s1">,</span>
                    <span class="s1">ticks: {</span>
                        <span class="s1">callback: </span><span class="s2">function</span><span class="s1">(value) {</span>
                            <span class="s2">return </span><span class="s3">'Rs. ' </span><span class="s1">+ formatPrice(value);</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Render orders chart</span>
<span class="s2">function </span><span class="s1">renderOrdersChart(data) {</span>
    <span class="s1">const ctx = document.getElementById(</span><span class="s3">'ordersChart'</span><span class="s1">).getContext(</span><span class="s3">'2d'</span><span class="s1">);</span>
    
    <span class="s2">if </span><span class="s1">(chartInstances.ordersChart) {</span>
        <span class="s1">chartInstances.ordersChart.destroy();</span>
    <span class="s1">}</span>
    
    <span class="s1">const colors = {</span>
        <span class="s3">'DELIVERED'</span><span class="s1">: </span><span class="s3">'#28a745'</span><span class="s1">,</span>
        <span class="s3">'PENDING'</span><span class="s1">: </span><span class="s3">'#ffc107'</span><span class="s1">,</span>
        <span class="s3">'PROCESSING'</span><span class="s1">: </span><span class="s3">'#17a2b8'</span><span class="s1">,</span>
        <span class="s3">'CANCELLED'</span><span class="s1">: </span><span class="s3">'#dc3545'</span>
    <span class="s1">};</span>
    
    <span class="s1">chartInstances.ordersChart = </span><span class="s2">new </span><span class="s1">Chart(ctx, {</span>
        <span class="s1">type: </span><span class="s3">'doughnut'</span><span class="s1">,</span>
        <span class="s1">data: {</span>
            <span class="s1">labels: data.labels || [],</span>
            <span class="s1">datasets: [{</span>
                <span class="s1">data: data.values || [],</span>
                <span class="s1">backgroundColor: data.labels.map(label =&gt; colors[label] || </span><span class="s3">'#6c757d'</span><span class="s1">),</span>
                <span class="s1">borderWidth: </span><span class="s4">1</span>
            <span class="s1">}]</span>
        <span class="s1">},</span>
        <span class="s1">options: {</span>
            <span class="s1">responsive: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">maintainAspectRatio: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">plugins: {</span>
                <span class="s1">legend: {</span>
                    <span class="s1">position: </span><span class="s3">'bottom'</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Returns Management</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadReturns() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/returns'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const returns = await response.json();</span>
            <span class="s1">renderReturnsTable(returns);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading returns:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Render returns table</span>
<span class="s2">function </span><span class="s1">renderReturnsTable(returns) {</span>
    <span class="s1">const tbody = document.querySelector(</span><span class="s3">'#returnsTable tbody'</span><span class="s1">);</span>
    <span class="s1">tbody.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s1">returns.forEach(ret =&gt; {</span>
        <span class="s1">const row = document.createElement(</span><span class="s3">'tr'</span><span class="s1">);</span>
        <span class="s1">row.innerHTML = `</span>
            <span class="s1">&lt;td&gt;#${ret.id}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;#${ret.orderId}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;${ret.customerName}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;${ret.productName}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;${truncateText(ret.returnReason, </span><span class="s4">30</span><span class="s1">)}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;Rs. ${formatPrice(ret.refundAmount || </span><span class="s4">0</span><span class="s1">)}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;&lt;span class=</span><span class="s3">&quot;status-badge-admin status-${ret.returnStatus.toLowerCase()}&quot;</span><span class="s1">&gt;${ret.returnStatus}&lt;/span&gt;&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;${formatDate(ret.returnRequestedAt)}&lt;/td&gt;</span>
            <span class="s1">&lt;td&gt;</span>
                <span class="s1">${ret.returnStatus === </span><span class="s3">'REQUESTED' </span><span class="s1">? `</span>
                    <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-approve&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;processReturn(${ret.id}, 'APPROVED')&quot;</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-check&quot;</span><span class="s1">&gt;&lt;/i&gt;</span>
                    <span class="s1">&lt;/button&gt;</span>
                    <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-reject&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;processReturn(${ret.id}, 'REJECTED')&quot; </span><span class="s1">style=</span><span class="s3">&quot;margin-left: 5px;&quot;</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-times&quot;</span><span class="s1">&gt;&lt;/i&gt;</span>
                    <span class="s1">&lt;/button&gt;</span>
                <span class="s1">` : ret.returnStatus === </span><span class="s3">'APPROVED' </span><span class="s1">? `</span>
                    <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-approve&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;processReturn(${ret.id}, 'REFUNDED')&quot;</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-money-check&quot;</span><span class="s1">&gt;&lt;/i&gt; Refund</span>
                    <span class="s1">&lt;/button&gt;</span>
                <span class="s1">` : </span><span class="s3">''</span><span class="s1">}</span>
                <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-edit&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;viewReturnDetails(${ret.id})&quot; </span><span class="s1">style=</span><span class="s3">&quot;margin-left: 5px;&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-eye&quot;</span><span class="s1">&gt;&lt;/i&gt;</span>
                <span class="s1">&lt;/button&gt;</span>
            <span class="s1">&lt;/td&gt;</span>
        <span class="s1">`;</span>
        <span class="s1">tbody.appendChild(row);</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Process return</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">processReturn(returnId, action) {</span>
    <span class="s2">if </span><span class="s1">(!confirm(`Are you sure you want to ${action.toLowerCase()} </span><span class="s2">this return</span><span class="s1">?`)) {</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(`/api/admin/returns/${returnId}/process`, {</span>
            <span class="s1">method: </span><span class="s3">'POST'</span><span class="s1">,</span>
            <span class="s1">headers: {</span>
                <span class="s3">'Content-Type'</span><span class="s1">: </span><span class="s3">'application/json'</span>
            <span class="s1">},</span>
            <span class="s1">body: JSON.stringify({ action })</span>
        <span class="s1">});</span>
        
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">alert(`Return ${action.toLowerCase()} successfully!`);</span>
            <span class="s1">await loadReturns();</span>
            <span class="s1">await loadDashboardData(); </span><span class="s0">// Refresh stats</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">const error = await response.text();</span>
            <span class="s1">alert(`Error: ${error}`);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error processing return:'</span><span class="s1">, error);</span>
        <span class="s1">alert(</span><span class="s3">'Failed to process return. Please try again.'</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Catalog Management</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadCatalog() {</span>
    <span class="s1">await loadCategories();</span>
    <span class="s1">await loadStores();</span>
    <span class="s1">await loadProducts();</span>
<span class="s1">}</span>

<span class="s0">// Load categories for dropdown</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadCategories() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/categories'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const categories = await response.json();</span>
            <span class="s1">const select = document.getElementById(</span><span class="s3">'productCategory'</span><span class="s1">);</span>
            <span class="s1">select.innerHTML = </span><span class="s3">'&lt;option value=&quot;&quot;&gt;Select Category&lt;/option&gt;' </span><span class="s1">+</span>
                <span class="s1">categories.map(cat =&gt; `&lt;option value=</span><span class="s3">&quot;${cat.id}&quot;</span><span class="s1">&gt;${cat.name}&lt;/option&gt;`).join(</span><span class="s3">''</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading categories:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Load stores for dropdown</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadStores() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/stores'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const stores = await response.json();</span>
            <span class="s1">const select = document.getElementById(</span><span class="s3">'productStore'</span><span class="s1">);</span>
            <span class="s1">select.innerHTML = </span><span class="s3">'&lt;option value=&quot;&quot;&gt;Select Store&lt;/option&gt;' </span><span class="s1">+</span>
                <span class="s1">stores.map(store =&gt; `&lt;option value=</span><span class="s3">&quot;${store.id}&quot;</span><span class="s1">&gt;${store.name}&lt;/option&gt;`).join(</span><span class="s3">''</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading stores:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Load products</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadProducts() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/products'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const products = await response.json();</span>
            <span class="s1">renderProductsList(products);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading products:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Render products list</span>
<span class="s2">function </span><span class="s1">renderProductsList(products) {</span>
    <span class="s1">const container = document.getElementById(</span><span class="s3">'productsList'</span><span class="s1">);</span>
    <span class="s1">container.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s1">products.forEach(product =&gt; {</span>
        <span class="s1">const item = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
        <span class="s1">item.className = </span><span class="s3">'notification-item'</span><span class="s1">;</span>
        <span class="s1">item.innerHTML = `</span>
            <span class="s1">&lt;div class=</span><span class="s3">&quot;notification-header&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;strong&gt;${product.name}&lt;/strong&gt;</span>
                <span class="s1">&lt;span class=</span><span class="s3">&quot;status-badge-admin&quot;</span><span class="s1">&gt;${product.stock &gt; </span><span class="s4">0 </span><span class="s1">? </span><span class="s3">'In Stock' </span><span class="s1">: </span><span class="s3">'Out of Stock'</span><span class="s1">}&lt;/span&gt;</span>
            <span class="s1">&lt;/div&gt;</span>
            <span class="s1">&lt;div style=</span><span class="s3">&quot;display: flex; gap: 15px; margin-top: 10px;&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;div style=</span><span class="s3">&quot;width: 60px; height: 60px; background: #f0f2f2; border-radius: 4px; display: flex; align-items: center; justify-content: center;&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">${product.imageUrl ? </span>
                        <span class="s1">`&lt;img src=</span><span class="s3">&quot;${product.imageUrl}&quot; </span><span class="s1">style=</span><span class="s3">&quot;width: 100%; height: 100%; object-fit: cover; border-radius: 4px;&quot;</span><span class="s1">&gt;` :</span>
                        <span class="s1">`&lt;i class=</span><span class="s3">&quot;fas fa-box&quot; </span><span class="s1">style=</span><span class="s3">&quot;color: #999;&quot;</span><span class="s1">&gt;&lt;/i&gt;`</span>
                    <span class="s1">}</span>
                <span class="s1">&lt;/div&gt;</span>
                <span class="s1">&lt;div style=</span><span class="s3">&quot;flex: 1;&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;div style=</span><span class="s3">&quot;color: #666; font-size: 14px;&quot;</span><span class="s1">&gt;${product.category?.name || </span><span class="s3">'No Category'</span><span class="s1">}&lt;/div&gt;</span>
                    <span class="s1">&lt;div style=</span><span class="s3">&quot;color: #b12704; font-weight: bold; margin: 5px 0;&quot;</span><span class="s1">&gt;Rs. ${formatPrice(product.price)}&lt;/div&gt;</span>
                    <span class="s1">&lt;div style=</span><span class="s3">&quot;font-size: 12px; color: #666;&quot;</span><span class="s1">&gt;Stock: ${product.stock} | Store: ${product.store?.name || </span><span class="s3">'Unknown'</span><span class="s1">}&lt;/div&gt;</span>
                <span class="s1">&lt;/div&gt;</span>
            <span class="s1">&lt;/div&gt;</span>
            <span class="s1">&lt;div style=</span><span class="s3">&quot;margin-top: 10px; display: flex; gap: 5px;&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-edit&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;editProduct(${product.id})&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-edit&quot;</span><span class="s1">&gt;&lt;/i&gt; Edit</span>
                <span class="s1">&lt;/button&gt;</span>
                <span class="s1">&lt;button class=</span><span class="s3">&quot;action-btn action-delete&quot; </span><span class="s1">onclick=</span><span class="s3">&quot;deleteProduct(${product.id})&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;i class=</span><span class="s3">&quot;fas fa-trash&quot;</span><span class="s1">&gt;&lt;/i&gt; Delete</span>
                <span class="s1">&lt;/button&gt;</span>
            <span class="s1">&lt;/div&gt;</span>
        <span class="s1">`;</span>
        <span class="s1">container.appendChild(item);</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Add product</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">addProduct() {</span>
    <span class="s1">const name = document.getElementById(</span><span class="s3">'productName'</span><span class="s1">).value.trim();</span>
    <span class="s1">const price = parseFloat(document.getElementById(</span><span class="s3">'productPrice'</span><span class="s1">).value);</span>
    <span class="s1">const stock = parseInt(document.getElementById(</span><span class="s3">'productStock'</span><span class="s1">).value);</span>
    <span class="s1">const categoryId = document.getElementById(</span><span class="s3">'productCategory'</span><span class="s1">).value;</span>
    <span class="s1">const storeId = document.getElementById(</span><span class="s3">'productStore'</span><span class="s1">).value;</span>
    <span class="s1">const description = document.getElementById(</span><span class="s3">'productDescription'</span><span class="s1">).value.trim();</span>
    <span class="s1">const imageFile = document.getElementById(</span><span class="s3">'productImage'</span><span class="s1">).files[</span><span class="s4">0</span><span class="s1">];</span>
    
    <span class="s0">// Validation</span>
    <span class="s2">if </span><span class="s1">(!name || !price || !stock || !categoryId || !storeId) {</span>
        <span class="s1">alert(</span><span class="s3">'Please fill all required fields'</span><span class="s1">);</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    
    <span class="s0">// Create FormData for file upload</span>
    <span class="s1">const formData = </span><span class="s2">new </span><span class="s1">FormData();</span>
    <span class="s1">formData.append(</span><span class="s3">'name'</span><span class="s1">, name);</span>
    <span class="s1">formData.append(</span><span class="s3">'price'</span><span class="s1">, price);</span>
    <span class="s1">formData.append(</span><span class="s3">'stock'</span><span class="s1">, stock);</span>
    <span class="s1">formData.append(</span><span class="s3">'categoryId'</span><span class="s1">, categoryId);</span>
    <span class="s1">formData.append(</span><span class="s3">'storeId'</span><span class="s1">, storeId);</span>
    <span class="s1">formData.append(</span><span class="s3">'description'</span><span class="s1">, description);</span>
    <span class="s2">if </span><span class="s1">(imageFile) {</span>
        <span class="s1">formData.append(</span><span class="s3">'image'</span><span class="s1">, imageFile);</span>
    <span class="s1">}</span>
    
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/products'</span><span class="s1">, {</span>
            <span class="s1">method: </span><span class="s3">'POST'</span><span class="s1">,</span>
            <span class="s1">body: formData</span>
        <span class="s1">});</span>
        
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">alert(</span><span class="s3">'Product added successfully!'</span><span class="s1">);</span>
            
            <span class="s0">// Clear form</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productName'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productPrice'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productStock'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productDescription'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productImage'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'productImagePreview'</span><span class="s1">).innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
            
            <span class="s0">// Refresh products list</span>
            <span class="s1">await loadProducts();</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">const error = await response.text();</span>
            <span class="s1">alert(`Error: ${error}`);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error adding product:'</span><span class="s1">, error);</span>
        <span class="s1">alert(</span><span class="s3">'Failed to add product. Please try again.'</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Marketing - Send notification</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">sendNotification() {</span>
    <span class="s1">const title = document.getElementById(</span><span class="s3">'notificationTitle'</span><span class="s1">).value.trim();</span>
    <span class="s1">const message = document.getElementById(</span><span class="s3">'notificationMessage'</span><span class="s1">).value.trim();</span>
    <span class="s1">const type = document.getElementById(</span><span class="s3">'notificationType'</span><span class="s1">).value;</span>
    <span class="s1">const audience = document.getElementById(</span><span class="s3">'notificationAudience'</span><span class="s1">).value;</span>
    <span class="s1">const schedule = document.getElementById(</span><span class="s3">'notificationSchedule'</span><span class="s1">).value;</span>
    
    <span class="s2">if </span><span class="s1">(!title || !message) {</span>
        <span class="s1">alert(</span><span class="s3">'Please fill title and message'</span><span class="s1">);</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/notifications'</span><span class="s1">, {</span>
            <span class="s1">method: </span><span class="s3">'POST'</span><span class="s1">,</span>
            <span class="s1">headers: {</span>
                <span class="s3">'Content-Type'</span><span class="s1">: </span><span class="s3">'application/json'</span>
            <span class="s1">},</span>
            <span class="s1">body: JSON.stringify({</span>
                <span class="s1">title,</span>
                <span class="s1">message,</span>
                <span class="s1">type,</span>
                <span class="s1">targetAudience: audience,</span>
                <span class="s1">scheduledFor: schedule || </span><span class="s2">null</span>
            <span class="s1">})</span>
        <span class="s1">});</span>
        
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">alert(</span><span class="s3">'Notification sent successfully!'</span><span class="s1">);</span>
            
            <span class="s0">// Clear form</span>
            <span class="s1">document.getElementById(</span><span class="s3">'notificationTitle'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            <span class="s1">document.getElementById(</span><span class="s3">'notificationMessage'</span><span class="s1">).value = </span><span class="s3">''</span><span class="s1">;</span>
            
            <span class="s0">// Refresh notifications list</span>
            <span class="s1">await loadNotifications();</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">const error = await response.text();</span>
            <span class="s1">alert(`Error: ${error}`);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error sending notification:'</span><span class="s1">, error);</span>
        <span class="s1">alert(</span><span class="s3">'Failed to send notification. Please try again.'</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Load notifications</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadNotifications() {</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s3">'/api/admin/notifications'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const notifications = await response.json();</span>
            <span class="s1">renderNotifications(notifications);</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s3">'Error loading notifications:'</span><span class="s1">, error);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">// Render notifications</span>
<span class="s2">function </span><span class="s1">renderNotifications(notifications) {</span>
    <span class="s1">const container = document.getElementById(</span><span class="s3">'notificationsList'</span><span class="s1">);</span>
    <span class="s1">container.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s1">notifications.forEach(notification =&gt; {</span>
        <span class="s1">const item = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
        <span class="s1">item.className = </span><span class="s3">'notification-item'</span><span class="s1">;</span>
        <span class="s1">item.innerHTML = `</span>
            <span class="s1">&lt;div class=</span><span class="s3">&quot;notification-header&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;strong&gt;${notification.title}&lt;/strong&gt;</span>
                <span class="s1">&lt;span class=</span><span class="s3">&quot;notification-type type-${notification.type.toLowerCase()}&quot;</span><span class="s1">&gt;${notification.type}&lt;/span&gt;</span>
            <span class="s1">&lt;/div&gt;</span>
            <span class="s1">&lt;div style=</span><span class="s3">&quot;color: #666; margin: 10px 0;&quot;</span><span class="s1">&gt;${notification.message}&lt;/div&gt;</span>
            <span class="s1">&lt;div style=</span><span class="s3">&quot;display: flex; justify-content: space-between; font-size: 12px; color: #999;&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;span&gt;To: ${notification.targetAudience}&lt;/span&gt;</span>
                <span class="s1">&lt;span&gt;${formatDate(notification.createdAt)}&lt;/span&gt;</span>
            <span class="s1">&lt;/div&gt;</span>
        <span class="s1">`;</span>
        <span class="s1">container.appendChild(item);</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Utility Functions</span>
<span class="s2">function </span><span class="s1">formatPrice(price) {</span>
    <span class="s2">return new </span><span class="s1">Intl.NumberFormat(</span><span class="s3">'en-NP'</span><span class="s1">).format(price);</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">formatDate(dateString) {</span>
    <span class="s2">if </span><span class="s1">(!dateString) </span><span class="s2">return </span><span class="s3">'N/A'</span><span class="s1">;</span>
    <span class="s1">const date = </span><span class="s2">new </span><span class="s1">Date(dateString);</span>
    <span class="s2">return </span><span class="s1">date.toLocaleDateString(</span><span class="s3">'en-US'</span><span class="s1">, {</span>
        <span class="s1">year: </span><span class="s3">'numeric'</span><span class="s1">,</span>
        <span class="s1">month: </span><span class="s3">'short'</span><span class="s1">,</span>
        <span class="s1">day: </span><span class="s3">'numeric'</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">truncateText(text, length) {</span>
    <span class="s2">if </span><span class="s1">(!text) </span><span class="s2">return </span><span class="s3">''</span><span class="s1">;</span>
    <span class="s2">return </span><span class="s1">text.length &gt; length ? text.substring(</span><span class="s4">0</span><span class="s1">, length) + </span><span class="s3">'...' </span><span class="s1">: text;</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">previewProductImage(input) {</span>
    <span class="s1">const preview = document.getElementById(</span><span class="s3">'productImagePreview'</span><span class="s1">);</span>
    <span class="s1">preview.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s2">if </span><span class="s1">(input.files &amp;&amp; input.files[</span><span class="s4">0</span><span class="s1">]) {</span>
        <span class="s1">const reader = </span><span class="s2">new </span><span class="s1">FileReader();</span>
        <span class="s1">reader.onload = </span><span class="s2">function</span><span class="s1">(e) {</span>
            <span class="s1">const img = document.createElement(</span><span class="s3">'img'</span><span class="s1">);</span>
            <span class="s1">img.src = e.target.result;</span>
            <span class="s1">img.className = </span><span class="s3">'image-preview-item'</span><span class="s1">;</span>
            <span class="s1">preview.appendChild(img);</span>
        <span class="s1">}</span>
        <span class="s1">reader.readAsDataURL(input.files[</span><span class="s4">0</span><span class="s1">]);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">previewStoreImage(input) {</span>
    <span class="s1">const preview = document.getElementById(</span><span class="s3">'storeImagePreview'</span><span class="s1">);</span>
    <span class="s1">preview.innerHTML = </span><span class="s3">''</span><span class="s1">;</span>
    
    <span class="s2">if </span><span class="s1">(input.files &amp;&amp; input.files[</span><span class="s4">0</span><span class="s1">]) {</span>
        <span class="s1">const reader = </span><span class="s2">new </span><span class="s1">FileReader();</span>
        <span class="s1">reader.onload = </span><span class="s2">function</span><span class="s1">(e) {</span>
            <span class="s1">const img = document.createElement(</span><span class="s3">'img'</span><span class="s1">);</span>
            <span class="s1">img.src = e.target.result;</span>
            <span class="s1">img.className = </span><span class="s3">'image-preview-item'</span><span class="s1">;</span>
            <span class="s1">preview.appendChild(img);</span>
        <span class="s1">}</span>
        <span class="s1">reader.readAsDataURL(input.files[</span><span class="s4">0</span><span class="s1">]);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s2">function </span><span class="s1">logout() {</span>
    <span class="s1">localStorage.removeItem(</span><span class="s3">'user'</span><span class="s1">);</span>
    <span class="s1">window.location.href = </span><span class="s3">'/login-amazon.html'</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">// Export for global use</span>
<span class="s1">window.processReturn = processReturn;</span>
<span class="s1">window.addProduct = addProduct;</span>
<span class="s1">window.sendNotification = sendNotification;</span>
<span class="s1">window.logout = logout;</span>
<span class="s1">window.previewProductImage = previewProductImage;</span>
<span class="s1">window.previewStoreImage = previewStoreImage;</span>

<span class="s0">// Add more functions as needed...</span></pre>
</body>
</html>