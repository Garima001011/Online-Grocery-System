<html>
<head>
<title>login-amazon.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
login-amazon.js</font>
</center></td></tr></table>
<pre><span class="s0">// Amazon-style Login JavaScript</span>
<span class="s1">document.addEventListener(</span><span class="s2">'DOMContentLoaded'</span><span class="s1">, () =&gt; {</span>
    <span class="s0">// Check if user is already logged in</span>
    <span class="s1">const user = localStorage.getItem(</span><span class="s2">'user'</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(user) {</span>
        <span class="s1">redirectToDashboard(JSON.parse(user));</span>
    <span class="s1">}</span>

    <span class="s0">// Setup password toggle</span>
    <span class="s1">setupPasswordToggle();</span>

    <span class="s0">// Setup form submission</span>
    <span class="s1">setupLoginForm();</span>
<span class="s1">});</span>

<span class="s3">function </span><span class="s1">setupPasswordToggle() {</span>
    <span class="s1">const toggleButton = document.getElementById(</span><span class="s2">'togglePassword'</span><span class="s1">);</span>
    <span class="s1">const passwordInput = document.getElementById(</span><span class="s2">'password'</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(toggleButton &amp;&amp; passwordInput) {</span>
        <span class="s1">toggleButton.addEventListener(</span><span class="s2">'click'</span><span class="s1">, () =&gt; {</span>
            <span class="s1">const type = passwordInput.getAttribute(</span><span class="s2">'type'</span><span class="s1">) === </span><span class="s2">'password' </span><span class="s1">? </span><span class="s2">'text' </span><span class="s1">: </span><span class="s2">'password'</span><span class="s1">;</span>
            <span class="s1">passwordInput.setAttribute(</span><span class="s2">'type'</span><span class="s1">, type);</span>

            <span class="s0">// Toggle eye icon</span>
            <span class="s1">const icon = toggleButton.querySelector(</span><span class="s2">'i'</span><span class="s1">);</span>
            <span class="s3">if </span><span class="s1">(type === </span><span class="s2">'password'</span><span class="s1">) {</span>
                <span class="s1">icon.className = </span><span class="s2">'fas fa-eye'</span><span class="s1">;</span>
            <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
                <span class="s1">icon.className = </span><span class="s2">'fas fa-eye-slash'</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">setupLoginForm() {</span>
    <span class="s1">const loginButton = document.getElementById(</span><span class="s2">'loginButton'</span><span class="s1">);</span>
    <span class="s1">const emailInput = document.getElementById(</span><span class="s2">'email'</span><span class="s1">);</span>
    <span class="s1">const passwordInput = document.getElementById(</span><span class="s2">'password'</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(loginButton) {</span>
        <span class="s1">loginButton.addEventListener(</span><span class="s2">'click'</span><span class="s1">, handleLogin);</span>
    <span class="s1">}</span>

    <span class="s0">// Allow Enter key to submit</span>
    <span class="s3">if </span><span class="s1">(emailInput &amp;&amp; passwordInput) {</span>
        <span class="s1">emailInput.addEventListener(</span><span class="s2">'keypress'</span><span class="s1">, (e) =&gt; {</span>
            <span class="s3">if </span><span class="s1">(e.key === </span><span class="s2">'Enter'</span><span class="s1">) handleLogin();</span>
        <span class="s1">});</span>

        <span class="s1">passwordInput.addEventListener(</span><span class="s2">'keypress'</span><span class="s1">, (e) =&gt; {</span>
            <span class="s3">if </span><span class="s1">(e.key === </span><span class="s2">'Enter'</span><span class="s1">) handleLogin();</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">async </span><span class="s3">function </span><span class="s1">handleLogin() {</span>
    <span class="s1">const email = document.getElementById(</span><span class="s2">'email'</span><span class="s1">).value.trim();</span>
    <span class="s1">const password = document.getElementById(</span><span class="s2">'password'</span><span class="s1">).value;</span>
    <span class="s1">const loginButton = document.getElementById(</span><span class="s2">'loginButton'</span><span class="s1">);</span>

    <span class="s0">// Clear previous errors</span>
    <span class="s1">clearErrors();</span>

    <span class="s0">// Validate inputs</span>
    <span class="s3">if </span><span class="s1">(!email) {</span>
        <span class="s1">showError(</span><span class="s2">'emailError'</span><span class="s1">, </span><span class="s2">'Enter your email or mobile phone number'</span><span class="s1">);</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(!password) {</span>
        <span class="s1">showError(</span><span class="s2">'passwordError'</span><span class="s1">, </span><span class="s2">'Enter your password'</span><span class="s1">);</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s0">// Show loading state</span>
    <span class="s1">loginButton.classList.add(</span><span class="s2">'loading'</span><span class="s1">);</span>
    <span class="s1">loginButton.disabled = </span><span class="s3">true</span><span class="s1">;</span>

    <span class="s3">try </span><span class="s1">{</span>
        <span class="s1">const response = await fetch(</span><span class="s2">'/api/auth/login'</span><span class="s1">, {</span>
            <span class="s1">method: </span><span class="s2">'POST'</span><span class="s1">,</span>
            <span class="s1">headers: {</span>
                <span class="s2">'Content-Type'</span><span class="s1">: </span><span class="s2">'application/json'</span>
            <span class="s1">},</span>
            <span class="s1">body: JSON.stringify({ email, password })</span>
        <span class="s1">});</span>

        <span class="s3">if </span><span class="s1">(response.ok) {</span>
            <span class="s1">const user = await response.json();</span>

            <span class="s0">// Save user to localStorage</span>
            <span class="s1">localStorage.setItem(</span><span class="s2">'user'</span><span class="s1">, JSON.stringify(user));</span>

            <span class="s0">// Show success message</span>
            <span class="s1">showSuccess(</span><span class="s2">'Login successful! Redirecting...'</span><span class="s1">);</span>

            <span class="s0">// Redirect based on role</span>
            <span class="s1">setTimeout(() =&gt; {</span>
                <span class="s1">redirectToDashboard(user);</span>
            <span class="s1">}, </span><span class="s4">1000</span><span class="s1">);</span>

        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s1">const error = await response.text();</span>
            <span class="s1">showError(</span><span class="s2">'passwordError'</span><span class="s1">, </span><span class="s2">'Incorrect email or password'</span><span class="s1">);</span>
        <span class="s1">}</span>

    <span class="s1">} </span><span class="s3">catch </span><span class="s1">(error) {</span>
        <span class="s1">console.error(</span><span class="s2">'Login error:'</span><span class="s1">, error);</span>
        <span class="s1">showError(</span><span class="s2">'passwordError'</span><span class="s1">, </span><span class="s2">'Network error. Please try again.'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">finally </span><span class="s1">{</span>
        <span class="s0">// Reset loading state</span>
        <span class="s1">loginButton.classList.remove(</span><span class="s2">'loading'</span><span class="s1">);</span>
        <span class="s1">loginButton.disabled = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">redirectToDashboard(user) {</span>
    <span class="s3">switch </span><span class="s1">(user.role) {</span>
        <span class="s3">case </span><span class="s2">'ADMIN'</span><span class="s1">:</span>
            <span class="s1">window.location.href = </span><span class="s2">'/admin-amazon.html'</span><span class="s1">;</span>
            <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">case </span><span class="s2">'DELIVERY'</span><span class="s1">:</span>
            <span class="s1">window.location.href = </span><span class="s2">'/delivery.html'</span><span class="s1">;</span>
            <span class="s3">break</span><span class="s1">;</span>
        <span class="s3">default</span><span class="s1">:</span>
            <span class="s1">window.location.href = </span><span class="s2">'/shop-amazon.html'</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">showError(elementId, message) {</span>
    <span class="s1">const element = document.getElementById(elementId);</span>
    <span class="s3">if </span><span class="s1">(element) {</span>
        <span class="s1">element.textContent = message;</span>
        <span class="s1">element.style.display = </span><span class="s2">'block'</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">showSuccess(message) {</span>
    <span class="s0">// Create success toast</span>
    <span class="s1">const toast = document.createElement(</span><span class="s2">'div'</span><span class="s1">);</span>
    <span class="s1">toast.style.cssText = `</span>
        <span class="s1">position: fixed;</span>
        <span class="s1">top: </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">right: </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">background: </span><span class="s3">var</span><span class="s1">(--amazon-green);</span>
        <span class="s1">color: white;</span>
        <span class="s1">padding: </span><span class="s4">15</span><span class="s1">px </span><span class="s4">20</span><span class="s1">px;</span>
        <span class="s1">border-radius: </span><span class="s4">4</span><span class="s1">px;</span>
        <span class="s1">z-index: </span><span class="s4">1000</span><span class="s1">;</span>
        <span class="s1">animation: slideIn </span><span class="s4">0</span><span class="s1">.</span><span class="s4">3</span><span class="s1">s ease;</span>
    <span class="s1">`;</span>
    <span class="s1">toast.textContent = message;</span>
    <span class="s1">document.body.appendChild(toast);</span>

    <span class="s1">setTimeout(() =&gt; {</span>
        <span class="s1">toast.remove();</span>
    <span class="s1">}, </span><span class="s4">3000</span><span class="s1">);</span>
<span class="s1">}</span>

<span class="s3">function </span><span class="s1">clearErrors() {</span>
    <span class="s1">const errors = document.querySelectorAll(</span><span class="s2">'.error-message'</span><span class="s1">);</span>
    <span class="s1">errors.forEach(error =&gt; {</span>
        <span class="s1">error.style.display = </span><span class="s2">'none'</span><span class="s1">;</span>
    <span class="s1">});</span>
<span class="s1">}</span>

<span class="s0">// Add CSS animation for toast</span>
<span class="s1">const style = document.createElement(</span><span class="s2">'style'</span><span class="s1">);</span>
<span class="s1">style.textContent = `</span>
    <span class="s1">@keyframes slideIn {</span>
        <span class="s1">from { transform: translateX(</span><span class="s4">100</span><span class="s1">%); opacity: </span><span class="s4">0</span><span class="s1">; }</span>
        <span class="s1">to { transform: translateX(</span><span class="s4">0</span><span class="s1">); opacity: </span><span class="s4">1</span><span class="s1">; }</span>
    <span class="s1">}</span>
<span class="s1">`;</span>
<span class="s1">document.head.appendChild(style);</span></pre>
</body>
</html>